#VRML_SIM R2023b utf8
# license: Creative Commons Attribution 4.0 International License.
# license url: https://creativecommons.org/licenses/by/4.0/legalcode
# ROBODYNO_PRO_02A 关节电机.
# 减速比：15
# 最大速度：246 rpm
# 最大力矩：3.1 N⋅m
# documentation url: http://101.42.250.169/1.7.1/references/components/webots/motor/
# template language: javascript

PROTO Pro_JP15 [
  field SFVec3f    translation 0 0 0
  field SFRotation rotation    0 0 1 0
  field SFString   motor_id    "0x10"
  field SFString{"motorFlange", "motorHousing"} outputEnd "motorFlange" 
  field SFFloat    position    0
  field MFNode     children    []
]

{
  Solid {
    translation IS translation
    rotation IS rotation
    name %<= "\"Pro_JP15_" + fields.motor_id.value + "\"" >%
    children[
      %< if ( fields.outputEnd.value  == "motorFlange") { >%
        Transform {
          rotation 1 0 0 1.5708
          children [
            CadShape {
              url [
                "shapes/Joint-base.dae"
              ]
              castShadows FALSE
            }
            HingeJoint {
              jointParameters HingeJointParameters {
                position IS position
                axis 0 1 0
              }
              device [
                RotationalMotor {
                  name %<= "\"" + fields.motor_id.value + "::motor\"" >%
                  controlPID 30 0 0
                  maxVelocity 95
                  maxTorque 4
                  acceleration -1
                }
                PositionSensor {
                  name "ROBODYNO_PRO_02A"
                }
              ]
              endPoint Solid {
                rotation 0 1 0 0
                children [
                  Transform {
                    translation 0 0.091 0
                    rotation 1 0 0 -1.5708
                    children IS children
                  }
                  CadShape {
                    url [
                      "shapes/Joint-end.dae"
                    ]
                    castShadows FALSE
                  }
                ]
                boundingObject Transform {
                  translation 0 0.085 0
                  rotation 1 0 0 1.5708
                  children [
                    Cylinder {
                      height 0.012
                      radius 0.02
                    }
                  ]
                }
                physics Physics {
                  density -1
                  mass 0.03
                }
              }
            }
          ]
        }
      %< } else if (fields.outputEnd.value == "motorHousing") { >%
        Transform {
          rotation 1 0 0 1.5708
          children [
            CadShape {
              url [
                "shapes/Joint-end.dae"
              ]
              castShadows FALSE
            }
            HingeJoint {
              jointParameters HingeJointParameters {
                position IS position
                axis 0 -1 0
              }
              device [
                RotationalMotor {
                  name %<= "\"" + fields.motor_id.value + "::motor\"" >%
                  controlPID 30 0 0
                  maxVelocity 95
                  maxTorque 4
                  acceleration -1
                }
                PositionSensor {
                  name "ROBODYNO_PRO_02A"
                }
              ]
              endPoint Solid {
                rotation 0 1 0 0
                children [
                  Transform {
                    translation 0 0.091 0
                    rotation 1 0 0 -1.5708
                    children IS children
                  }
                  CadShape {
                    url [
                      "shapes/Joint-base.dae"
                    ]
                    castShadows FALSE
                  }
                ]
                boundingObject Transform {
                  translation 0 0.085 0
                  rotation 1 0 0 1.5708
                  children [
                    Cylinder {
                      height 0.012
                      radius 0.02
                    }
                  ]
                }
                physics Physics {
                  density -1
                  mass 0.03
                }
              }
            }
          ]
        }
      %< } >%

    ]
    boundingObject Transform {
      translation 0 0 0.0395
      children [
        Cylinder {
          height 0.079
          radius 0.025
        }
      ]
    }
    physics Physics {
      density -1
      mass 0.34
    }
  }
}
